<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>Fact Checker</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 40px; }
      .result { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
      .confirmed { background-color: #d4f8d4; }
      .refuted { background-color: #ffd3d3; }
      .unclear { background-color: #fff7cc; }
      h2 { margin-top: 40px; }
      pre { white-space: pre-wrap; }
    </style>
  </head>

  <body>
    <h1>Wikipedia Fact Checker</h1>

    <textarea id="text" rows="10" cols="80" placeholder="Paste text here..."></textarea><br/>
    <button id="send">Check Facts</button>

    <h2>Results</h2>
    <div id="results"></div>

    <script>
      document.getElementById('send').addEventListener('click', async () => {
        const text = document.getElementById('text').value.trim();
        if (!text) return alert('Please enter text');

        let data;
        try {
          const res = await fetch('/extract-and-verify', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text })
          });
          if (!res.ok) {
            const errorText = await res.text();
            throw new Error(errorText || 'Request failed');
          }
          data = await res.json();
        } catch (err) {
          const container = document.getElementById('results');
          container.innerHTML = `<p>Request error: ${err.message}</p>`;
          return;
        }

        const container = document.getElementById('results');
        container.innerHTML = "";

        if (!data.results || data.results.length === 0) {
          container.innerHTML = "<p>No claims found.</p>";
          return;
        }

        data.results.forEach(r => {
          const div = document.createElement("div");
          div.className = "result";

          const claimTitle = document.createElement("h3");
          claimTitle.textContent = "Claim:";
          div.appendChild(claimTitle);

          const claimText = document.createElement("p");
          claimText.textContent = r.claim || "(missing claim)";
          div.appendChild(claimText);

          const evidenceTitle = document.createElement("h4");
          evidenceTitle.textContent = "Wikipedia summary:";
          div.appendChild(evidenceTitle);

          const evidenceText = document.createElement("p");
          evidenceText.textContent = r.found || "No summary available.";
          div.appendChild(evidenceText);

          const evidenceListTitle = document.createElement("h4");
          evidenceListTitle.textContent = "Evidence sentences:";
          div.appendChild(evidenceListTitle);

          if (Array.isArray(r.evidence) && r.evidence.length > 0) {
            const evidenceList = document.createElement("ul");
            r.evidence.forEach(sentence => {
              const li = document.createElement("li");
              li.textContent = sentence;
              evidenceList.appendChild(li);
            });
            div.appendChild(evidenceList);
          } else {
            const noEvidence = document.createElement("p");
            noEvidence.textContent = "No evidence sentences found.";
            div.appendChild(noEvidence);
          }

          if (r.source) {
            const sourceP = document.createElement("p");
            const link = document.createElement("a");
            link.href = r.source;
            link.target = "_blank";
            link.rel = "noopener noreferrer";
            link.textContent = "Source";
            sourceP.appendChild(link);
            div.appendChild(sourceP);
          }

          container.appendChild(div);
        });
      });
    </script>
  </body>
</html>
